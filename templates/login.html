{% extends "layout_guest.html" %}
{% block title %}تسجيل الدخول - SA System{% endblock %}
{% block content %}
<div class="login-page">
    <div class="login-card" role="main" aria-labelledby="loginTitle">
        <h2 id="loginTitle">تسجيل الدخول</h2>
        <p class="login-subtitle">اختر نوع الحساب ثم أدخل بيانات الاعتماد</p>

        <div class="login-tabs" role="tablist" aria-label="نوع الحساب">
            <button class="login-tab-button active" role="tab" aria-selected="true" data-target="supervisorForm">تسجيل للمشرف</button>
            <button class="login-tab-button" role="tab" aria-selected="false" data-target="instructorForm">تسجيل للأستاذ</button>
        </div>

        <div class="login-forms">
            <form id="supervisorForm" class="login-form" autocomplete="on">
                <label class="form-group">
                    <span>اسم المستخدم</span>
                    <input class="form-control" type="text" id="supervisorUsername" name="username" placeholder="اسم المستخدم" />
                </label>
                <label class="form-group">
                    <span>كلمة المرور</span>
                    <div class="pw-wrapper">
                        <input class="form-control" type="password" id="supervisorPassword" name="password" placeholder="كلمة المرور" />
                        <button type="button" class="pw-toggle" data-target="supervisorPassword" aria-label="إظهار كلمة المرور"><i class="fas fa-eye"></i></button>
                    </div>
                </label>
                <label class="form-group remember-group">
                    <input type="checkbox" id="rememberSupervisor" /> تذكرني
                </label>
                <div class="form-actions">
                    <button type="button" class="btn btn-primary btn-block" onclick="submitLogin('supervisor')">دخول</button>
                </div>
            </form>

            <form id="instructorForm" class="login-form" style="display:none;" autocomplete="on">
                <label class="form-group">
                    <span>اسم المستخدم</span>
                    <input class="form-control" type="text" id="instructorUsername" name="username" placeholder="اسم المستخدم" />
                </label>
                <label class="form-group">
                    <span>كلمة المرور</span>
                    <div class="pw-wrapper">
                        <input class="form-control" type="password" id="instructorPassword" name="password" placeholder="كلمة المرور" />
                        <button type="button" class="pw-toggle" data-target="instructorPassword" aria-label="إظهار كلمة المرور"><i class="fas fa-eye"></i></button>
                    </div>
                </label>
                <label class="form-group remember-group">
                    <input type="checkbox" id="rememberInstructor" /> تذكرني
                </label>
                <div class="form-actions">
                    <button type="button" class="btn btn-primary btn-block" onclick="submitLogin('instructor')">دخول</button>
                </div>
            </form>
        </div>

        <div class="login-footer">
            <small>نسيت كلمة المرور؟ تواصل مع مدير النظام</small>
        </div>
    </div>
</div>

<!-- Login styles moved to `static/css/login.css` -->

<script>
(function(){
    // Tab switching
    document.querySelectorAll('.login-tab-button').forEach(btn => {
        btn.addEventListener('click', function(){
            document.querySelectorAll('.login-tab-button').forEach(b => { b.classList.remove('active'); b.setAttribute('aria-selected','false'); });
            this.classList.add('active'); this.setAttribute('aria-selected','true');
            const target = this.getAttribute('data-target');
            document.querySelectorAll('.login-form').forEach(f => f.style.display = 'none');
            const el = document.getElementById(target);
            if(el) el.style.display = 'block';
        });
    });

    // Show / hide password
    document.querySelectorAll('.pw-toggle').forEach(btn => {
        btn.addEventListener('click', function(){
            const targetId = this.getAttribute('data-target');
            const input = document.getElementById(targetId);
            if(!input) return;
            if(input.type === 'password') { input.type = 'text'; this.innerHTML = '<i class="fas fa-eye-slash"></i>'; }
            else { input.type = 'password'; this.innerHTML = '<i class="fas fa-eye"></i>'; }
        });
    });

    // Remember me: store username for each form
    function loadRemembered(){
        try{
            const sUser = localStorage.getItem('remember_supervisor_username');
            if(sUser) document.getElementById('supervisorUsername').value = sUser, document.getElementById('rememberSupervisor').checked = true;
            const iUser = localStorage.getItem('remember_instructor_username');
            if(iUser) document.getElementById('instructorUsername').value = iUser, document.getElementById('rememberInstructor').checked = true;
        }catch(e){}
    }
    loadRemembered();

    // Note: actual submitLogin is provided by `static/js/login.js` which validates against Firebase
    // If it's not loaded for some reason, provide a minimal fallback to avoid errors
    if(typeof window.submitLogin !== 'function'){
        window.submitLogin = function(type){
            if(typeof window.showToast === 'function') window.showToast('جارٍ الاتصال بالخادم... الرجاء المحاولة مرة أخرى إذا استمرت المشكلة.', 'warning', 2000);
            else alert('جارٍ الاتصال بالخادم... الرجاء المحاولة مرة أخرى إذا استمرت المشكلة.');
        };
    }
})();
</script>

{% endblock %}
